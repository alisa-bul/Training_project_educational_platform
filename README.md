# Training_project_educational_platform
## https://karpov.courses/
## Задание 1. A/B–тестирование

*Условие*. Одной из основных задач аналитика в нашей команде является корректное проведение экспериментов. Для этого мы применяем метод A/B–тестирования. В ходе тестирования одной гипотезы целевой группе была предложена новая механика оплаты услуг на сайте, у контрольной группы оставалась базовая механика. В качестве задания вам необходимо проанализировать итоги эксперимента и сделать вывод, стоит ли запускать новую механику оплаты на всех пользователей.

*Входные данные*. В качестве входных данных вы имеете 4 csv-файла:

- groups.csv – файл с информацией о принадлежности пользователя к контрольной или экспериментальной группе (А – контроль, B – целевая группа);
- groups_add.csv – дополнительный файл с пользователями, который вам прислали спустя 2 дня после передачи данных;
- active_studs.csv – файл с информацией о пользователях, которые зашли на платформу в дни проведения эксперимента;
- checks.csv – файл с информацией об оплатах пользователей в дни проведения эксперимента.

*Вопросы*. Предлагаем вам ответить на следующие вопросы:

- На какие метрики вы смотрите в ходе анализа и почему?
- Имеются ли различия в показателях и с чем они могут быть связаны?
- Являются ли эти различия статистически значимыми?
- Стоит ли запускать новую механику на всех пользователей?

## Отчет по результатам выполнения первого задания

Для оценки эффективности внедрения новой механики оплаты услуг на сайте образовательной платформы проведен A/B-тест. Данные для проведения тестирования включали информацию о принадлежности 74484 пользователей сайта к контрольной (14671, 19.7%) и тестовой (59813, 80.3%) группам, об активности этих пользователей и о сумме совершенных ими платежей на сайте в дни проведения эксперимента. Результаты теста оценивались на пользователях, которые зашли на платформу в дни проведения эксперимента: 8328 студентов, из которых 1535 (18.4%) принадлежат контрольной группе и 6793 (81.6%) - целевой. Для получения достоверных выводов по результатам экспериментов в дальнейшем *необходимо пересмотреть систему сплитования*, чтобы размер выборок был сопоставимым.

Выбраны 3 наиболее чувствительные к результатам эксперимента метрики: *конверсия в оплату (CR)*, *средний доход на пользователя (ARPU)* и *средний доход на платящего пользователя (ARPPU)*. Проверялась следующая гипотеза: *Если внедрим новую механику оплаты, то пользователи сайта образовательной платформы перестанут стопориться на оплате услуг, вследствие чего CR, ARPU и ARPPU статистически значимо увеличатся*.

Для проверки гипотезы относительно *CR* использовался критерий Хи-квадрат. Конверсия в оплату для контрольной группы cоставила 5.1%, а для целевой группы - 4.6%. *Тест не выявил значимых различий между CR в контрольной и целевой группах*.

Метрики *ARPU* (для контрольной группы - 47.44 руб., для целевой - 57.86 руб.) и *ARPPU* (для контрольной группы - 933.59 руб., для целевой - 1255.83 руб.) оказались выше в тестовой группе. Данные о платежах по выборкам не соответствовали условиям проведения t-теста Стьюдента: распределения отличались от нормального, присутствовали аномально высокие значения. Метод бутстрапа показал *значимые различия ARPPU* и *незначимые различия ARPU* в контрольной и тестовой группах.

Результаты проведенного эксперимента неоднозначны. A/B-тестирование не выявило значимых различий в CR и ARPU для контрольной и целевой групп, но **ARPPU оказался значимо выше в тестовой группе (на 34,5%)**. Напрашивается вывод о том, что новая механика оплаты услуг действительно упрощает и ускоряет процесс оплаты (особенно для тех, кто ранее уже совершал платежи). Эффект от внедрения новой механики оплаты, оцененный по метрике ARPPU, оказался достаточно сильным для принятия решения в пользу **запуска нововведений на всех пользователей**. Однако следует учесть, что изначально пользователи по группам распределены неравномерно, а это может сказаться на точности выводов. Также *необходимо разобраться в причинах появления в данных 149 пользователей, которые совершали платежи в дни проведения эксперимента, но не учитывались как активные*.

## Задание 2. SQL
### 2.1 Очень усердные ученики

*Условие*. Образовательные курсы состоят из различных уроков, каждый из которых состоит из нескольких маленьких заданий. Каждое такое маленькое задание называется "горошиной". Назовём очень усердным учеником того пользователя, который хотя бы раз за текущий месяц правильно решил 20 горошин.\
*Задание*. Дана таблица **peas**:

|Название атрибута	|Тип атрибута	|Смысловое значение                      |
|-------------------|-------------|----------------------------------------|
|st_id	            |int	        |ID ученика                              |
|timest	            |timestamp	  |Время решения карточки                  |
|correct        	  |bool	        |Правильно ли решена горошина?           |
|subject	          |text	        |Дисциплина, в которой находится горошина|

Необходимо написать оптимальный запрос, который даст информацию о количестве очень усердных студентов.\
NB! Под *усердным* студентом мы понимаем студента, который **правильно решил 20 задач за текущий месяц**.

### Выводы
В рамках задания 2.1 сформировано *два варианта* запроса:
- количество усердных студентов за октябрь 2021 года (исходя из имеющихся данных)
- количество усердных студентов за <u>текущий месяц</u>
*Первый вариант*
```
SELECT
  COUNT(st_id) AS number_of_diligent_students
FROM
  (
    SELECT
      st_id,
      SUM(correct :: integer)
    FROM
      peas
    GROUP BY
      st_id
    HAVING
      SUM(correct :: integer) >= 20
  ) AS diligent_students;
```
*Второй вариант*
```
SELECT
  COUNT(st_id) AS number_of_diligent_students
FROM
  (
    SELECT
      st_id,
      SUM(correct :: integer)
    FROM
      peas
    WHERE
      to_char(timest, 'MM/YYYY') = to_char(CURRENT_DATE, 'MM/YYYY')
    GROUP BY
      st_id
    HAVING
      SUM(correct :: integer) >= 20
  ) AS diligent_students;
```

### 2.2 Оптимизация воронки

*Условие*. Образовательная платформа предлагает пройти студентам курсы по модели trial: студент может решить бесплатно лишь 30 горошин в день. Для неограниченного количества заданий в определенной дисциплине студенту необходимо приобрести полный доступ. Команда провела эксперимент, где был протестирован новый экран оплаты.

*Задание*. Даны таблицы **peas** (в задании 2.1), **studs** и **final_project_check**. \
Таблица **studs**:

|Название атрибута	|Тип атрибута	|Смысловое значение                   |
|-------------------|-------------|-------------------------------------|
|st_id	            |int	        |ID ученика                           |
|test_grp           |text         |Метка ученика в данном эксперименте  |

Таблица **final_project_check**:

|Название атрибута	|Тип атрибута	|Смысловое значение                     |
|-------------------|-------------|---------------------------------------|
|st_id	            |int	        |ID ученика                             |
|sale_time          |timestamp    |Время покупки                          |
|money	            |int	        |Цена, по которой приобрели данный курс |
|subject	          |text 	      |Дисциплина                             |

Необходимо в одном запросе выгрузить следующую информацию о группах пользователей:
- ARPU 
- ARPAU 
- CR в покупку 
- СR активного пользователя в покупку 
- CR пользователя из активности по математике (subject = ’math’) в покупку курса по математике

ARPU считается относительно всех пользователей, попавших в группы.\
**Активным** считается пользователь, *за все время решивший **больше 10** задач правильно в любых дисциплинах*.\
**Активным по математике** считается пользователь, *за все время решивший **2 или больше** задач правильно по математике*.

### Выводы
Написан SQL-запрос, который выводит следующую информацию:

|test_grp|arpu    |arpau   |cr   |cr_active|cr_math_active|
|--------|--------|--------|-----|---------|--------------|
|control |4540.98 |10393.70|4.92 |11.02    |6.12          |
|pilot   |11508.47|29739.58|10.85|26.04    |9.52          |

## Задание 3. Python

Необходимо реализовать:
- функцию, которая будет автоматически подгружать информацию из дополнительного файла groups_add.csv (заголовки могут отличаться) и на основании дополнительных параметров пересчитывать метрики;
- функцию, которая будет строить графики по получаемым метрикам.

## Выводы
Написана функция **add_data**, принимающая на вход считанные данные файлов groups.csv, groups_add.csv, active_studs.csv и checks.csv. На выходе функции получаем датафрейм local_metrics, в котором содержатся пересчитанные метрики CR, ARPU и ARPPU по группам с учетом новых данных.\
Написана функция **show_diagram**, которая принимает на вход таблицу с метриками и строит столбчатые диаграммы по значениям метрик CR, ARPU и ARPPU по группам.
